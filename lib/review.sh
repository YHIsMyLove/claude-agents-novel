#!/usr/bin/env bash
# Novel Assistant - è¯„ä»·è„šæœ¬
# ç”¨é€”ï¼šè°ƒèµ·å¤š agents è¿›è¡Œè¯„ä»·

source "$(dirname "${BASH_SOURCE[0]}")/utils.sh"

# è¯„ä»·å‡½æ•°
function review_work() {
    local file="$1"
    local project_root=$(get_project_root "$(dirname "$file")")

    if [[ -z "$project_root" ]]; then
        echo "âš ï¸  æœªæ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•"
        return 1
    fi

    print_header "ðŸ“– å¤šè§†è§’è¯„ä»·"
    echo "ðŸ“ è¯„ä»·æ–‡ä»¶: $file"
    echo ""

    # è¯»å–æ–‡ä»¶å†…å®¹
    local content=$(cat "$file")

    # å¹¶è¡Œè°ƒèµ· agentsï¼ˆæ¨¡æ‹Ÿï¼‰
    # å®žé™…ä½¿ç”¨ä¸­ä¼šé€šè¿‡ Claude çš„ agent ç³»ç»Ÿè°ƒèµ·

    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "  æ­£åœ¨è°ƒèµ·è¯„ä»· agents..."
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""

    # æ¨¡æ‹Ÿè¾“å‡ºï¼ˆå®žé™…ç”± Claude agent ç”Ÿæˆï¼‰
    # è¿™é‡Œåªæ˜¯ä¸€ä¸ªç¤ºä¾‹æ ¼å¼

    print_header "ðŸ“Š è¯„ä»·æŠ¥å‘Š"
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "  ðŸ‘¥ æ™®é€šè¯»è€…"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ã€é˜…è¯»ä½“éªŒã€‘ 7.5/10"
    echo "  å¼€å¤´å¾ˆå¸å¼•äººï¼Œæƒ³ç»§ç»­çœ‹ä¸‹åŽ»"
    echo ""
    echo "ã€ä¼˜ç‚¹ã€‘"
    echo "  - ä¸»è§’åŠ¨æœºæ˜Žç¡®"
    echo "  - å¯¹è¯è‡ªç„¶"
    echo ""
    echo "ã€å»ºè®®ã€‘"
    echo "  - ä¸­é—´æœ‰äº›åœ°æ–¹èŠ‚å¥å¤ªå¿«"
    echo "  - å¯ä»¥åŠ ä¸€äº›åœºæ™¯æå†™"
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "  ðŸ‘¨ èµ„æ·±ä¹¦è¯„äºº"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ã€æ–‡å­¦æŠ€å·§ã€‘ 7.0/10"
    echo "  ç»“æž„å®Œæ•´ï¼Œäººç‰©å¡‘é€ ç«‹ä½“"
    echo ""
    echo "ã€ä¼˜ç‚¹ã€‘"
    echo "  - äººç‰©å¯¹è¯è‡ªç„¶ï¼Œæ€§æ ¼é²œæ˜Ž"
    echo "  - èŠ‚å¥æŠŠæŽ§åˆç†"
    echo ""
    echo "ã€å»ºè®®ã€‘"
    echo "  - åæ´¾å‡ºåœºç¨æ˜¾çªå…€ï¼Œå¯åŠ é“ºåž«"
    echo "  - å¯åœ¨ ch-002 ä¸­åŸ‹ä¸‹ä¼ç¬”"
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "  ðŸ‘” ç¼–è¾‘"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ã€å•†ä¸šä»·å€¼ã€‘ 6.8/10"
    echo "  è¾¾åˆ°ç­¾çº¦æ ‡å‡†çº¿ï¼Œæœ‰æå‡ç©ºé—´"
    echo ""
    echo "ã€ä¼˜ç‚¹ã€‘"
    echo "  - æ•´ä½“ç»“æž„å®Œæ•´"
    echo "  - å¸‚åœºå®šä½æ¸…æ™°"
    echo ""
    echo "ã€å»ºè®®ã€‘"
    echo "  - å­—æ•°åå°‘ï¼Œå»ºè®®æ‰©å……åˆ° 3000+ å­—"
    echo "  - æ›´æ–°é¢‘çŽ‡éœ€è¦ç¨³å®š"
    echo ""

    # ä¿å­˜è¯„ä»·è®°å½•
    local review_dir="$project_root/reviews"
    mkdir -p "$review_dir"

    local review_file="$review_dir/$(date +%Y%m%d).md"
    cat > "$review_file" << EOF
# è¯„ä»·æŠ¥å‘Š - $(date +%Y-%m-%d)

## è¯„ä»·æ–‡ä»¶
$file

## ç»¼åˆè¯„åˆ†
6.8/10

## è¯¦ç»†è¯„ä»·
...

EOF

    echo "âœ… è¯„ä»·å·²ä¿å­˜åˆ°: $review_file"
}

# ä¸»å‡½æ•°
main() {
    if [[ ${BASH_SOURCE[0]} == *"review.sh" ]]; then
        source "$(dirname "${BASH_SOURCE[0]}")/utils.sh"
    fi

    review_work "$@"
}
